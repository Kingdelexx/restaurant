{% extends 'base.html' %}

{% block content %}

<h1>Pay with Paystack</h1>
<p>Order ID: {{ order.id }} - Total Amount: â‚¦{{ order.total_amount }}</p>
<button id="payBTN">Pay Now</button>

{% endblock %}

{% block scripts %}
<script src="https://js.paystack.co/v1/inline.js"></script>

<script>
document.getElementById('payBTN').addEventListener('click', function() {
    var handler = PaystackPop.setup({
        key: '{{ paystack_public_key }}',
        email: '{{ order.user.email }}',
        currency: 'NGN',
        amount: {{ amount }},
        ref: '{{ reference }}',
        callback: function(response){
            window.location.href = "{% url 'verify' %}?reference=" + response.reference;
        },
        onClose: function(){
            alert('Payment window closed.');
        }
    });
    handler.openIframe();
});
</script>

{% endblock %}
